<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Work Hours & Time Tracker — Davi Nevae</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* ======================================================================
   FULLY RESPONSIVE, MOBILE-FIRST STYLE SYSTEM
   ====================================================================== */

:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --muted:#6b7280;
  --accent:#2563eb;
  --accent2:#0ea5a4;
  --danger:#ef4444;
  --radius:10px;
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color-scheme:light;
}

[data-theme="dark"]{
  --bg:#0b1220;
  --card:#071025;
  --muted:#9aa4b2;
  --accent:#3b82f6;
  --accent2:#14b8a6;
  --danger:#fb7185;
  color-scheme:dark;
}

html, body{
  margin:0;
  padding:0;
  background:var(--bg);
  overflow-x:hidden;
}

.app{
  width:100%;
  max-width:1100px;
  margin:0 auto;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
}

header{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  padding:18px;
  border-bottom:1px solid rgba(0,0,0,0.06);
  background:linear-gradient(90deg,transparent,rgba(0,0,0,0.02));
}

.brand h1{
  margin:0;
  font-size:18px;
}
.brand p{
  margin:0;
  color:var(--muted);
  font-size:12px;
}

.controls{
  margin-left:auto;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.btn{
  padding:8px 12px;
  border-radius:8px;
  border:0;
  cursor:pointer;
  font-weight:600;
  background:var(--accent);
  color:#fff;
}
.btn.secondary{
  background:transparent;
  color:var(--accent);
  border:1px solid rgba(37,99,235,0.25);
}
.btn.ghost{
  background:transparent;
  color:var(--muted);
  border:1px dashed rgba(0,0,0,0.15);
}
.btn.warn{
  background:var(--danger);
  color:#fff;
}

main{
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
@media(min-width:900px){
  main{
    display:grid;
    grid-template-columns:380px 1fr;
  }
}

.panel{
  background:rgba(255,255,255,0.5);
  padding:14px;
  border-radius:var(--radius);
}

label{
  font-size:13px;
  margin-bottom:4px;
  display:block;
  color:var(--muted);
}

input,textarea,select{
  width:100%;
  padding:10px;
  font-size:14px;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.08);
  margin-bottom:10px;
  background:transparent;
  color:inherit;
}

.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.timer{
  display:flex;
  gap:8px;
  align-items:center;
  margin:10px 0;
}

.small{
  font-size:12px;
  color:var(--muted);
}

.right{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Table */
.table-wrap{
  width:100%;
  overflow-x:auto;
  padding:8px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
  min-width:850px;
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(0,0,0,0.06);
  text-align:left;
}
th{
  font-weight:700;
  font-size:12px;
  color:var(--muted);
}

.chip{
  padding:6px 10px;
  border-radius:999px;
  background:rgba(37,99,235,0.1);
  color:var(--accent);
  font-weight:600;
  font-size:13px;
}

footer{
  padding:12px;
  border-top:1px solid rgba(0,0,0,0.06);
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
}

.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}

.modal{
  background:var(--card);
  padding:14px;
  border-radius:10px;
  width:94%;
  max-width:700px;
}

.summary-card{
  padding:12px;
  border-radius:8px;
  background:rgba(0,0,0,0.03);
  margin-top:12px;
}

@media(max-width:500px){
  header{
    justify-content:flex-start;
  }
  .controls{
    width:100%;
    justify-content:flex-start;
  }
  table{ font-size:12px; }
}
</style>

<!-- jsPDF (PDF export) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>


<body>
<div class="app" id="app" data-theme="light">

<header>
  <div class="brand">
    <h1>Work Hours & Time Tracker</h1>
    <p>Fast • Private • Exportable — Built by Davi Nevae LLC</p>
  </div>
  <div class="controls">
    <button id="toggleTheme" class="btn secondary">Dark</button>
    <button id="importCsv" class="btn ghost">Import CSV</button>
    <button id="exportCsv" class="btn">Export CSV</button>
    <button id="exportPdf" class="btn secondary">Export PDF</button>
  </div>
</header>

<main>

<!-- LEFT PANEL -->
<aside class="panel">
  <label>Date</label>
  <input id="date" type="date"/>

  <div class="grid2">
    <div>
      <label>Start</label>
      <input id="start" type="time"/>
    </div>
    <div>
      <label>End</label>
      <input id="end" type="time"/>
    </div>
  </div>

  <label>Break minutes</label>
  <input id="break" type="number" value="0"/>

  <label>Rate ($/hr)</label>
  <input id="rate" type="number" step="0.01"/>

  <label>Tax (%)</label>
  <input id="tax" type="number" value="22"/>

  <label>Tag</label>
  <input id="tag" type="text"/>

  <label>Notes</label>
  <textarea id="notes" rows="2"></textarea>

  <div class="timer">
    <button id="startTimer" class="btn">Start</button>
    <button id="stopTimer" class="btn secondary" disabled>Stop</button>
    <div id="liveTimer" class="small">Timer inactive</div>
  </div>

  <div class="grid2">
    <button id="calcSave" class="btn">Save Entry</button>
    <button id="clearForm" class="btn secondary">Clear</button>
  </div>

  <div id="instantSummary" class="summary-card" style="display:none;">
    <strong>Session:</strong> <span id="sessionText"></span><br/>
    <span class="small">Duration: <span id="durationText"></span> — Earnings: <span id="earningsText"></span></span>
  </div>
</aside>

<!-- RIGHT PANEL -->
<section class="right">

  <div class="panel">
    <div style="display:flex;justify-content:space-between;">
      <div>
        <strong>History</strong><br/>
        <span class="small">Local entries</span>
      </div>
      <button id="clearHistory" class="btn ghost">Clear</button>
    </div>
  </div>

  <div class="panel table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th><th>Start</th><th>End</th><th>Break</th>
          <th>Hours</th><th>Rate</th><th>Earnings</th>
          <th>Tag</th><th>Notes</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>
  </div>

  <div class="panel">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="chip" id="totalHours">Total: 0h</div>
      <div class="chip" id="totalEarnings">$0.00</div>
      <span class="small">Entries: <span id="entryCount">0</span></span>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
      <button id="exportSummaryCsv" class="btn">Export Summary CSV</button>
      <button id="downloadExcel" class="btn secondary">Excel CSV</button>
      <button id="exportPdfEntries" class="btn secondary">Entries PDF</button>
    </div>

    <div style="margin-top:16px;">
      <strong style="font-size:14px;">Weekly / Monthly Summary</strong>
      <div id="summaries" class="small" style="margin-top:8px;color:var(--muted);"></div>
    </div>
  </div>

</section>

</main>

<footer>
  <span class="small">Built by Davi Nevae LLC</span>
  <span class="small">Storage key: dnw_master_v3</span>
</footer>

</div>



<!-- EDIT MODAL -->
<div id="modal" class="modal-backdrop">
  <div class="modal">
    <h3>Edit Entry</h3>

    <div class="grid2">
      <div><label>Date</label><input id="m_date" type="date"></div>
      <div><label>Start</label><input id="m_start" type="time"></div>
      <div><label>End</label><input id="m_end" type="time"></div>
      <div><label>Break</label><input id="m_break" type="number"></div>
      <div><label>Rate</label><input id="m_rate" type="number" step="0.01"></div>
      <div><label>Tag</label><input id="m_tag" type="text"></div>
    </div>

    <label>Notes</label>
    <textarea id="m_notes" rows="3"></textarea>

    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
      <button id="modalCancel" class="btn secondary">Cancel</button>
      <button id="modalSave" class="btn">Save</button>
    </div>
  </div>
</div>



<!-- FULL APP LOGIC -->
<script>
(function(){

const STORAGE_KEY = "dnw_master_v3";
const $ = id => document.getElementById(id);

const dateInput = $("date");
const startInput = $("start");
const endInput = $("end");
const breakInput = $("break");
const rateInput = $("rate");
const tagInput = $("tag");
const notesInput = $("notes");

const historyBody = $("historyBody");
const totalHoursChip = $("totalHours");
const totalEarningsChip = $("totalEarnings");
const entryCount = $("entryCount");

dateInput.value = new Date().toISOString().slice(0,10);

function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]"); }catch{ return[];} }
function save(a){ localStorage.setItem(STORAGE_KEY, JSON.stringify(a)); }

function calcMinutes(start,end,br){
  if(!(start&&end)) return 0;
  const [sh,sm]=start.split(":").map(Number);
  const [eh,em]=end.split(":").map(Number);
  let s=sh*60+sm; let e=eh*60+em;
  if(e<s) e+=1440;
  return Math.max(0, (e-s)-Number(br||0));
}
function earn(min,r){ return r? Math.round((min/60*r)*100)/100 : 0; }

$("clearForm").onclick=()=>{
  dateInput.value=new Date().toISOString().slice(0,10);
  startInput.value=""; endInput.value="";
  breakInput.value="0"; rateInput.value="";
  tagInput.value=""; notesInput.value="";
  $("instantSummary").style.display="none";
};

$("calcSave").onclick=()=>{
  const d=dateInput.value, s=startInput.value, e=endInput.value,
        br=Number(breakInput.value||0), r=rateInput.value?Number(rateInput.value):null;
  const m=calcMinutes(s,e,br);
  if(m<=0){ alert("Duration must be greater than zero"); return; }

  const entry={
    id:String(Date.now())+Math.random().toString(36).slice(2),
    date:d,start:s,end:e,break:br,minutes:m,
    rate:r,tag:tagInput.value,notes:notesInput.value,
    createdAt:new Date().toISOString()
  };
  const arr=load(); arr.unshift(entry); save(arr);

  $("sessionText").textContent=`${d} ${s} → ${e}`;
  $("durationText").textContent=(m/60).toFixed(2)+"h";
  $("earningsText").textContent=r? "$"+earn(m,r).toFixed(2) : "—";
  $("instantSummary").style.display="block";

  render();
};

function render(){
  const arr=load();
  historyBody.innerHTML="";
  arr.forEach(e=>{
    const tr=document.createElement("tr");
    const hrs=(e.minutes/60).toFixed(2);
    const earned=e.rate? earn(e.minutes,e.rate).toFixed(2):"";
    tr.innerHTML=`
      <td>${e.date}</td>
      <td>${e.start}</td>
      <td>${e.end}</td>
      <td>${e.break}</td>
      <td>${hrs}</td>
      <td>${e.rate? "$"+e.rate.toFixed(2):""}</td>
      <td>${earned? "$"+earned:""}</td>
      <td>${e.tag||""}</td>
      <td>${(e.notes||"").replace(/</g,"&lt;")}</td>
      <td>
        <button class="btn secondary del" data-id="${e.id}">Delete</button>
      </td>`;
    historyBody.appendChild(tr);
  });

  const totalMin=arr.reduce((s,x)=>s+x.minutes,0);
  const totalEarn=arr.reduce((s,x)=>s+(x.rate?earn(x.minutes,x.rate):0),0);

  totalHoursChip.textContent=`Total: ${(totalMin/60).toFixed(2)}h`;
  totalEarningsChip.textContent=`$${totalEarn.toFixed(2)}`;
  entryCount.textContent=arr.length;

  document.querySelectorAll(".del").forEach(btn=>{
    btn.onclick=()=>{
      if(!confirm("Delete entry?")) return;
      const d=load().filter(x=>x.id!==btn.dataset.id);
      save(d); render();
    };
  });
}

render();
   /* ======================================================================
   EXPORT FUNCTIONS
   ====================================================================== */

function download(filename, content, type="text/csv") {
  const blob = new Blob([content], { type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

/* FULL CSV EXPORT */
$("exportCsv").onclick = () => {
  const arr = load();
  if (!arr.length) return alert("No entries to export.");

  let csv = "Date,Start,End,Break,Hours,Rate,Earnings,Tag,Notes\n";

  arr.forEach(e => {
    const hrs = (e.minutes / 60).toFixed(2);
    const earn = e.rate ? (e.minutes / 60 * e.rate).toFixed(2) : "";
    csv += [
      e.date, e.start, e.end, e.break, hrs,
      e.rate || "", earn, e.tag || "",
      (e.notes || "").replace(/,/g, ";")
    ].join(",") + "\n";
  });

  download("work-hours.csv", csv);
};

/* SUMMARY CSV (WEEK + MONTH) */
$("exportSummaryCsv").onclick = () => {
  const arr = load();
  if (!arr.length) return alert("No entries to summarize.");

  const weekly = {};
  const monthly = {};

  arr.forEach(e => {
    const dt = new Date(e.date);
    const year = dt.getFullYear();
    const week = Math.ceil((((dt - new Date(year,0,1)) / 86400000) + new Date(year,0,1).getDay() + 1) / 7);
    const month = dt.getMonth() + 1;

    if (!weekly[week]) weekly[week] = { minutes:0, money:0 };
    if (!monthly[month]) monthly[month] = { minutes:0, money:0 };

    weekly[week].minutes += e.minutes;
    monthly[month].minutes += e.minutes;

    if (e.rate) {
      weekly[week].money += (e.minutes/60 * e.rate);
      monthly[month].money += (e.minutes/60 * e.rate);
    }
  });

  let csv = "Period,Hours,Earnings\n";

  Object.keys(weekly).forEach(w => {
    csv += `Week ${w},${(weekly[w].minutes/60).toFixed(2)},${weekly[w].money.toFixed(2)}\n`;
  });

  Object.keys(monthly).forEach(m => {
    csv += `Month ${m},${(monthly[m].minutes/60).toFixed(2)},${monthly[m].money.toFixed(2)}\n`;
  });

  download("summary.csv", csv);
};

/* EXCEL CSV EXPORT */
$("downloadExcel").onclick = () => {
  const arr = load();
  if (!arr.length) return alert("No data to export.");

  let csv = "Date,Start,End,Break,Hours,Rate,Earnings,Tag,Notes\r\n";

  arr.forEach(e => {
    const hrs = (e.minutes / 60).toFixed(2);
    const earn = e.rate ? (e.minutes/60 * e.rate).toFixed(2) : "";
    csv += `"${e.date}","${e.start}","${e.end}","${e.break}",` +
           `"${hrs}","${e.rate||""}","${earn}","${e.tag||""}","${(e.notes||"").replace(/"/g,"'")}"\r\n`;
  });

  download("excel-export.csv", csv, "application/vnd.ms-excel");
};

/* PDF (SUMMARY ONLY) */
$("exportPdf").onclick = () => {
  const arr = load();
  if (!arr.length) return alert("No entries to export.");

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text("Work Hours Summary", 10, 15);

  let y = 30;
  let totalMin = 0, totalEarn = 0;

  arr.forEach(e => {
    const hrs = (e.minutes/60).toFixed(2);
    const earn = e.rate ? (e.minutes/60*e.rate).toFixed(2) : "0.00";

    totalMin += e.minutes;
    totalEarn += parseFloat(earn);

    doc.setFontSize(11);
    doc.text(`${e.date}: ${hrs} hrs — $${earn}`, 10, y);
    y += 8;
    if (y > 270) { doc.addPage(); y = 20; }
  });

  doc.setFontSize(14);
  doc.text(`Total Hours: ${(totalMin/60).toFixed(2)}`, 10, y+10);
  doc.text(`Total Earnings: $${totalEarn.toFixed(2)}`, 10, y+20);

  doc.save("summary.pdf");
};

/* PDF (ENTRIES TABLE EXPORT) */
$("exportPdfEntries").onclick = () => {
  const arr = load();
  if (!arr.length) return alert("No entries to export.");

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation:"landscape" });

  doc.setFontSize(14);
  doc.text("Work Hours — Full Entry Export", 10, 15);

  const headers = ["Date","Start","End","Break","Hours","Rate","Earn","Tag","Notes"];
  const rows = arr.map(e => {
    const hrs = (e.minutes/60).toFixed(2);
    const earnVal = e.rate ? (e.minutes/60*e.rate).toFixed(2) : "";
    return [
      e.date, e.start, e.end, e.break,
      hrs, e.rate||"", earnVal, e.tag||"", e.notes||""
    ];
  });

  let y = 30;
  doc.setFontSize(10);
  doc.text(headers.join("   "), 10, y);
  y += 7;

  rows.forEach(row => {
    doc.text(row.join(" | "), 10, y);
    y += 6;
    if (y > 190) { doc.addPage(); y = 20; }
  });

  doc.save("entries.pdf");
};

})();
</script>

</body>
</html>
