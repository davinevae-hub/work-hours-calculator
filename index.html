<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Tracker — Davi Nevae</title>
<style>
    :root {
        --primary: #2563eb;
        --bg: #f3f4f6;
        --card: #ffffff;
        --text: #1f2937;
        --border: #e5e7eb;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
        line-height: 1.5;
    }

    .container {
        max-width: 900px;
        margin: 0 auto;
        display: grid;
        gap: 20px;
    }

    /* Cards */
    .card {
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Header */
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    h1 { margin: 0; font-size: 1.5rem; }
    .subtitle { font-size: 0.875rem; color: #6b7280; }

    /* Form Grid */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        align-items: end;
    }

    .form-group { display: flex; flex-direction: column; }
    label { font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #4b5563; }
    
    input, button {
        padding: 10px;
        border-radius: 6px;
        border: 1px solid var(--border);
        font-size: 1rem;
    }

    button {
        background: var(--primary);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: opacity 0.2s;
    }
    button:hover { opacity: 0.9; }
    button.secondary { background: white; color: var(--text); border: 1px solid var(--border); }
    button.danger { background: #ef4444; color: white; }

    /* Table */
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th, td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border); }
    th { background: #f9fafb; font-size: 0.85rem; color: #6b7280; }
    
    /* Summary Bar */
    .summary {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        background: #e0e7ff;
        padding: 15px;
        border-radius: 8px;
        color: var(--primary);
        font-weight: bold;
    }

    @media (max-width: 600px) {
        .form-grid { grid-template-columns: 1fr 1fr; }
        .full-width-mobile { grid-column: span 2; }
    }
</style>
</head>
<body>

<div class="container">
    
    <header>
        <div>
            <h1>Work & Time Tracker</h1>
            <div class="subtitle">Built by Davi Nevae LLC</div>
        </div>
        <button onclick="exportCSV()" class="secondary">Download CSV</button>
    </header>

    <div class="card">
        <form id="timeForm" onsubmit="addEntry(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" id="start" required>
                </div>
                <div class="form-group">
                    <label>End Time</label>
                    <input type="time" id="end" required>
                </div>
                <div class="form-group">
                    <label>Break (Mins)</label>
                    <input type="number" id="breakTime" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Rate ($/hr)</label>
                    <input type="number" id="rate" value="50" step="0.01">
                </div>
                <div class="form-group full-width-mobile">
                    <label>Description / Tag</label>
                    <input type="text" id="desc" placeholder="e.g. Client Meeting">
                </div>
                <div class="form-group full-width-mobile">
                    <button type="submit">Add Entry</button>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="summary">
            <span>Total Hours: <span id="totalHours">0.00</span> h</span>
            <span>Total Earnings: $<span id="totalMoney">0.00</span></span>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Times</th>
                        <th>Break</th>
                        <th>Desc</th>
                        <th>Hrs</th>
                        <th>Earned</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="logBody">
                    </tbody>
            </table>
        </div>
        
        <div style="margin-top:15px; text-align:right;">
             <button onclick="clearAllData()" class="secondary" style="font-size:0.8rem; color:#ef4444; border-color:#fca5a5;">Reset All Data</button>
        </div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const STORAGE_KEY = "davi_nevae_tracker_v1";

    // --- INITIALIZATION ---
    document.addEventListener("DOMContentLoaded", () => {
        // Set default date to today
        document.getElementById("date").valueAsDate = new Date();
        renderTable();
    });

    // --- CORE LOGIC ---
    function getEntries() {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }

    function saveEntries(entries) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        renderTable();
    }

    function addEntry(e) {
        e.preventDefault();
        
        const date = document.getElementById("date").value;
        const start = document.getElementById("start").value;
        const end = document.getElementById("end").value;
        const breakMins = parseFloat(document.getElementById("breakTime").value) || 0;
        const rate = parseFloat(document.getElementById("rate").value) || 0;
        const desc = document.getElementById("desc").value;

        // Calculate Duration
        let startTime = new Date(`2000-01-01T${start}`);
        let endTime = new Date(`2000-01-01T${end}`);
        
        // Handle overnight shifts (if end time is before start time)
        if (endTime < startTime) {
            endTime.setDate(endTime.getDate() + 1);
        }

        let diffMs = endTime - startTime;
        let diffMins = Math.floor(diffMs / 60000) - breakMins;
        
        if (diffMins <= 0) {
            alert("Error: Duration is zero or negative after break deduction.");
            return;
        }

        const hours = parseFloat((diffMins / 60).toFixed(2));
        const earnings = parseFloat((hours * rate).toFixed(2));

        const newEntry = {
            id: Date.now(),
            date,
            start,
            end,
            breakMins,
            rate,
            desc,
            hours,
            earnings
        };

        const entries = getEntries();
        entries.unshift(newEntry); // Add to top
        saveEntries(entries);
        
        // Optional: Clear description but keep rate/date for fast entry
        document.getElementById("desc").value = "";
    }

    function deleteEntry(id) {
        if(confirm("Delete this entry?")) {
            const entries = getEntries().filter(e => e.id !== id);
            saveEntries(entries);
        }
    }

    function clearAllData() {
        if(confirm("Are you sure? This will delete all history.")) {
            localStorage.removeItem(STORAGE_KEY);
            renderTable();
        }
    }

    function renderTable() {
        const entries = getEntries();
        const tbody = document.getElementById("logBody");
        tbody.innerHTML = "";

        let sumHours = 0;
        let sumMoney = 0;

        entries.forEach(e => {
            sumHours += e.hours;
            sumMoney += e.earnings;

            const row = `
                <tr>
                    <td>${e.date}</td>
                    <td>${e.start} - ${e.end}</td>
                    <td>${e.breakMins}m</td>
                    <td>${e.desc}</td>
                    <td><strong>${e.hours}</strong></td>
                    <td>$${e.earnings.toFixed(2)}</td>
                    <td><button onclick="deleteEntry(${e.id})" class="danger" style="padding:4px 8px; font-size:0.8rem;">×</button></td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

        document.getElementById("totalHours").innerText = sumHours.toFixed(2);
        document.getElementById("totalMoney").innerText = sumMoney.toFixed(2);
    }

    function exportCSV() {
        const entries = getEntries();
        if (entries.length === 0) { alert("No data to export"); return; }

        let csv = "Date,Start,End,Break(m),Description,Hours,Rate,Earnings\n";
        
        entries.forEach(e => {
            // Escape commas in description to prevent breaking CSV
            const safeDesc = `"${e.desc.replace(/"/g, '""')}"`; 
            csv += `${e.date},${e.start},${e.end},${e.breakMins},${safeDesc},${e.hours},${e.rate},${e.earnings}\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `TimeTracker_Export_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
    }
</script>

</body>
</html>
